{"files":[{"id":"1fa12dcf-e380-4488-a7b2-4bf4bd2d7563","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Seoul\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_ACCESSING\",\n    \"access\": \"ANYONE\"\n  }\n}"},{"id":"0a041ed6-7fc3-4c14-adaf-5de83bd79673","name":"Code","type":"server_js","source":"// Entry point for the web app\nfunction doGet() {\n  return HtmlService.createHtmlOutputFromFile(\u0027index\u0027)\n    .setTitle(\u0027í•˜ì´ì¼€ì–´ë´‡\u0027)\n    .addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1\u0027)\n    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);\n}\n\n// Spreadsheet ID for storing chat history, feedback, and logs\nconst SPREADSHEET_ID \u003d \u0027YOUR_SPREADSHEET_ID\u0027; // Replace with your Google Sheets ID\nconst CHAT_SHEET_NAME \u003d \u0027ChatHistory\u0027;\nconst FEEDBACK_SHEET_NAME \u003d \u0027Feedback\u0027;\nconst LOG_SHEET_NAME \u003d \u0027ErrorLogs\u0027;\nconst INTENT_WEIGHTS_SHEET_NAME \u003d \u0027IntentWeights\u0027;\n\n// Rate limiting configuration\nconst RATE_LIMIT_KEY \u003d \u0027userRateLimit\u0027;\nconst RATE_LIMIT_WINDOW_MS \u003d 60000; // 1 minute\nconst MAX_REQUESTS_PER_WINDOW \u003d 30;\n\n// Intent keywords with weights and entities\nconst INTENT_KEYWORDS \u003d {\n  \u0027greeting\u0027: { keywords: [\u0027ì•ˆë…•\u0027, \u0027ì‹œì‘\u0027, \u0027í•˜ì´\u0027], weight: 0.9, entities: [] },\n  \u0027auto_insurance\u0027: { keywords: [\u0027ìë™ì°¨\u0027, \u0027ì°¨ëŸ‰\u0027, \u0027ìë™ì°¨ ë³´í—˜\u0027], weight: 0.8, entities: [\u0027car_type\u0027, \u0027insurance_type\u0027] },\n  \u0027medical_insurance\u0027: { keywords: [\u0027ì‹¤ì†\u0027, \u0027ì˜ë£Œ\u0027, \u0027ë³‘ì›\u0027, \u0027ì‹¤ì† ì˜ë£Œë³´í—˜\u0027], weight: 0.8, entities: [\u0027coverage_type\u0027] },\n  \u0027consultation\u0027: { keywords: [\u0027ìƒë‹´\u0027, \u0027ë¬¸ì˜\u0027, \u0027ì˜ˆì•½\u0027, \u0027ìƒë‹´ ì˜ˆì•½\u0027], weight: 0.7, entities: [\u0027consultation_type\u0027] },\n  \u0027premium_calculation\u0027: { keywords: [\u0027ë³´í—˜ë£Œ ê³„ì‚°\u0027, \u0027ê²¬ì \u0027], weight: 0.7, entities: [\u0027insurance_type\u0027] },\n  \u0027recommended_product\u0027: { keywords: [\u0027ì¶”ì²œ ìƒí’ˆ\u0027, \u0027ë§ì¶¤\u0027], weight: 0.7, entities: [\u0027user_preference\u0027] },\n  \u0027branch_info\u0027: { keywords: [\u0027ì§€ì  ì•ˆë‚´\u0027, \u0027ì§€ì \u0027], weight: 0.6, entities: [\u0027location\u0027] },\n  \u0027feedback\u0027: { keywords: [\u0027ë§Œì¡±\u0027, \u0027ë¶ˆë§Œì¡±\u0027, \u0027í”¼ë“œë°±\u0027], weight: 0.6, entities: [] }\n};\n\n// Sanitize user input to prevent XSS\nfunction sanitizeInput(input) {\n  if (!input) return \u0027\u0027;\n  return input.replace(/[\u003c\u003e\u0026\"\u0027]/g, match \u003d\u003e ({\n    \u0027\u003c\u0027: \u0027\u0026lt;\u0027,\n    \u0027\u003e\u0027: \u0027\u0026gt;\u0027,\n    \u0027\u0026\u0027: \u0027\u0026amp;\u0027,\n    \u0027\"\u0027: \u0027\u0026quot;\u0027,\n    \"\u0027\": \u0027\u0026#39;\u0027\n  }[match])).trim();\n}\n\n// Log errors to Google Sheets\nfunction logError(error, context) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const sheet \u003d ss.getSheetByName(LOG_SHEET_NAME) || ss.insertSheet(LOG_SHEET_NAME);\n    const timestamp \u003d new Date().toISOString();\n    sheet.appendRow([timestamp, context, error.message || JSON.stringify(error)]);\n  } catch (e) {\n    Logger.log(`Error logging failed: ${e.message}`);\n  }\n}\n\n// Check rate limit\nfunction checkRateLimit(userId) {\n  const cache \u003d CacheService.getUserCache();\n  const key \u003d `${RATE_LIMIT_KEY}:${userId}`;\n  let requests \u003d JSON.parse(cache.get(key) || \u0027{\"count\": 0, \"startTime\": 0}\u0027);\n  \n  const now \u003d Date.now();\n  if (now - requests.startTime \u003e RATE_LIMIT_WINDOW_MS) {\n    requests \u003d { count: 0, startTime: now };\n  }\n  \n  requests.count++;\n  cache.put(key, JSON.stringify(requests), 3600); // Cache for 1 hour\n  \n  if (requests.count \u003e MAX_REQUESTS_PER_WINDOW) {\n    throw new Error(\u0027ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\u0027);\n  }\n}\n\n// Enhanced intent detection with entity recognition\nfunction detectIntent(userInput) {\n  let bestIntent \u003d null;\n  let highestScore \u003d 0;\n  let entities \u003d {};\n  \n  userInput \u003d userInput.toLowerCase();\n  \n  // Load dynamic intent weights from spreadsheet\n  const dynamicWeights \u003d loadIntentWeights();\n  \n  for (const [intent, data] of Object.entries(INTENT_KEYWORDS)) {\n    let score \u003d 0;\n    const dynamicWeight \u003d dynamicWeights[intent] || data.weight;\n    \n    // Keyword-based scoring\n    data.keywords.forEach(keyword \u003d\u003e {\n      if (userInput.includes(keyword)) {\n        score +\u003d dynamicWeight * (keyword.length / userInput.length); // Normalize by input length\n      }\n    });\n    \n    // Entity recognition\n    data.entities.forEach(entity \u003d\u003e {\n      if (entity \u003d\u003d\u003d \u0027car_type\u0027 \u0026\u0026 /ì„¸ë‹¨|íŠ¸ëŸ­|SUV|ìŠ¹í•©ì°¨/i.test(userInput)) {\n        entities[entity] \u003d userInput.match(/ì„¸ë‹¨|íŠ¸ëŸ­|SUV|ìŠ¹í•©ì°¨/i)[0];\n        score +\u003d 0.2; // Bonus for entity match\n      } else if (entity \u003d\u003d\u003d \u0027insurance_type\u0027 \u0026\u0026 /ìë™ì°¨ë³´í—˜|ì‹¤ì†ë³´í—˜|ì¢…í•©ë³´í—˜/i.test(userInput)) {\n        entities[entity] \u003d userInput.match(/ìë™ì°¨ë³´í—˜|ì‹¤ì†ë³´í—˜|ì¢…í•©ë³´í—˜/i)[0];\n        score +\u003d 0.2;\n      } else if (entity \u003d\u003d\u003d \u0027consultation_type\u0027 \u0026\u0026 /ì „í™”|ì˜¨ë¼ì¸|ëŒ€ë©´/i.test(userInput)) {\n        entities[entity] \u003d userInput.match(/ì „í™”|ì˜¨ë¼ì¸|ëŒ€ë©´/i)[0];\n        score +\u003d 0.2;\n      }\n    });\n    \n    if (score \u003e highestScore) {\n      highestScore \u003d score;\n      bestIntent \u003d intent;\n    }\n  }\n  \n  return { intent: bestIntent || \u0027unknown\u0027, entities };\n}\n\n// Load dynamic intent weights from spreadsheet\nfunction loadIntentWeights() {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const sheet \u003d ss.getSheetByName(INTENT_WEIGHTS_SHEET_NAME) || ss.insertSheet(INTENT_WEIGHTS_SHEET_NAME);\n    const data \u003d sheet.getDataRange().getValues();\n    const weights \u003d {};\n    \n    for (let i \u003d 1; i \u003c data.length; i++) {\n      weights[data[i][0]] \u003d parseFloat(data[i][1]) || INTENT_KEYWORDS[data[i][0]]?.weight || 0.5;\n    }\n    \n    return weights;\n  } catch (error) {\n    logError(error, \u0027loadIntentWeights\u0027);\n    return {};\n  }\n}\n\n// Update intent weights based on feedback\nfunction updateIntentWeights() {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const feedbackSheet \u003d ss.getSheetByName(FEEDBACK_SHEET_NAME);\n    const chatSheet \u003d ss.getSheetByName(CHAT_SHEET_NAME);\n    \n    if (!feedbackSheet || !chatSheet) return;\n    \n    const feedbackData \u003d feedbackSheet.getDataRange().getValues();\n    const chatData \u003d chatSheet.getDataRange().getValues();\n    const intentCounts \u003d {};\n    const intentSatisfaction \u003d {};\n    \n    // Count intent occurrences from chat history\n    chatData.slice(1).forEach(row \u003d\u003e {\n      if (row[4] \u003d\u003d\u003d \u0027user\u0027) {\n        const intent \u003d detectIntent(row[3]).intent;\n        intentCounts[intent] \u003d (intentCounts[intent] || 0) + 1;\n      }\n    });\n    \n    // Analyze feedback for satisfaction\n    feedbackData.slice(1).forEach(row \u003d\u003e {\n      const feedback \u003d row[3].toLowerCase();\n      const intent \u003d detectIntent(feedback).intent;\n      intentSatisfaction[intent] \u003d (intentSatisfaction[intent] || 0) + (feedback.includes(\u0027ë§Œì¡±\u0027) ? 1 : feedback.includes(\u0027ë¶ˆë§Œì¡±\u0027) ? -1 : 0);\n    });\n    \n    // Update weights based on usage and satisfaction\n    const weightsSheet \u003d ss.getSheetByName(INTENT_WEIGHTS_SHEET_NAME) || ss.insertSheet(INTENT_WEIGHTS_SHEET_NAME);\n    const newWeights \u003d [[\u0027Intent\u0027, \u0027Weight\u0027]];\n    \n    for (const intent of Object.keys(INTENT_KEYWORDS)) {\n      const usageScore \u003d (intentCounts[intent] || 0) / (chatData.length - 1);\n      const satisfactionScore \u003d (intentSatisfaction[intent] || 0) / (feedbackData.length - 1);\n      const newWeight \u003d Math.min(1.0, Math.max(0.5, (INTENT_KEYWORDS[intent].weight + usageScore + satisfactionScore)));\n      newWeights.push([intent, newWeight]);\n    }\n    \n    weightsSheet.clear();\n    weightsSheet.getRange(1, 1, newWeights.length, 2).setValues(newWeights);\n  } catch (error) {\n    logError(error, \u0027updateIntentWeights\u0027);\n  }\n}\n\n// Process user input with enhanced NLU\nfunction processUserInput(userInput, userProfile) {\n  try {\n    // Sanitize input\n    userInput \u003d sanitizeInput(userInput);\n    \n    // Generate a simple user ID\n    const userId \u003d Utilities.base64Encode(userProfile.name + Date.now());\n    checkRateLimit(userId);\n    \n    const age \u003d parseInt(userProfile.age) || 30;\n    const occupation \u003d userProfile.occupation || \u0027ë¯¸ì…ë ¥\u0027;\n    const income \u003d parseInt(userProfile.income) || 0;\n    const insuranceExperience \u003d userProfile.insuranceExperience || \u0027ë¯¸ì…ë ¥\u0027;\n    const interest \u003d userProfile.interest || \u0027ë¯¸ì •/ìƒë‹´í•„ìš”\u0027;\n    \n    let response \u003d \u0027\u0027;\n    const disclaimer \u003d \u0027\\n\\n* ë³¸ ì •ë³´ëŠ” ë²•ì  êµ¬ì†ë ¥ì´ ì—†ìœ¼ë©°, ì •í™•í•œ ë‚´ìš©ì€ ìƒë‹´ì›ì„ í†µí•´ í™•ì¸í•´ ì£¼ì„¸ìš”.\u0027;\n    \n    // Save chat to history\n    saveChatHistory(userId, userProfile.name, userInput, \u0027user\u0027);\n    \n    const { intent, entities } \u003d detectIntent(userInput);\n    \n    switch (intent) {\n      case \u0027greeting\u0027:\n        response \u003d `ì•ˆë…•í•˜ì„¸ìš”, ${userProfile.name}ë‹˜! í˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´ë´‡ì…ë‹ˆë‹¤. ${interest \u003d\u003d\u003d \u0027ìë™ì°¨ë³´í—˜\u0027 ? \u0027ìë™ì°¨ë³´í—˜ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹œêµ°ìš”! ê²¬ì ì„ ë°”ë¡œ í™•ì¸í•˜ì‹œê² ì–´ìš”?\u0027 : interest \u003d\u003d\u003d \u0027ì‹¤ì†ë³´í—˜\u0027 ? \u0027ì‹¤ì†ì˜ë£Œë³´í—˜ì— ê´€ì‹¬ì´ ìˆìœ¼ì‹œêµ°ìš”! ë³´ì¥ ë‚´ìš©ì„ ì•ˆë‚´ë“œë¦´ê¹Œìš”?\u0027 : \u0027ì–´ë–¤ ë³´í—˜ ìƒí’ˆì— ëŒ€í•´ ì•Œì•„ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?\u0027}`;\n        break;\n        \n      case \u0027auto_insurance\u0027:\n        const carType \u003d entities.car_type || \u0027ì°¨ëŸ‰\u0027;\n        if (age \u003e\u003d 20 \u0026\u0026 age \u003c 30) {\n          response \u003d `20ëŒ€ ${occupation} ê³ ê°ë‹˜ì„ ìœ„í•œ ìë™ì°¨ë³´í—˜ ìƒí’ˆì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ${carType}ì— ì í•©í•œ ${insuranceExperience \u003d\u003d\u003d \u0027ì—†ìŒ\u0027 ? \u0027ì´ˆë³´ ìš´ì „ìë„ ë¶€ë‹´ ì—†ëŠ”\u0027 : \u0027ê°€ì… ê²½í—˜ì´ ìˆëŠ” ê³ ê°ë‹˜ê»˜ ì í•©í•œ\u0027} ì €ë ´í•œ ë””ì§€í„¸ ì „ìš© ìƒí’ˆì„ www.hi.co.krì—ì„œ 5ë¶„ ë§Œì— ê°€ì… ê°€ëŠ¥í•©ë‹ˆë‹¤!`;\n        } else if (age \u003e\u003d 30 \u0026\u0026 age \u003c 50) {\n          response \u003d `30~40ëŒ€ ${occupation} ê³ ê°ë‹˜ì„ ìœ„í•œ ìë™ì°¨ë³´í—˜ì…ë‹ˆë‹¤. ${carType}ì— ë§ì¶˜ ${income \u003e\u003d 500 ? \u0027í”„ë¦¬ë¯¸ì—„ ë³´ì¥ ì˜µì…˜\u0027 : \u0027í•©ë¦¬ì ì¸ ë³´ì¥ ì˜µì…˜\u0027}ì„ í¬í•¨í•œ ìƒí’ˆì„ ì˜¨ë¼ì¸(www.hi.co.kr) ë˜ëŠ” ìƒë‹´ì‚¬(1588-5656)ë¥¼ í†µí•´ ì„¤ê³„í•´ ë³´ì„¸ìš”.`;\n        } else {\n          response \u003d `ì•ˆì „ ì¤‘ì‹¬ì˜ ìë™ì°¨ë³´í—˜ ìƒí’ˆì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤. ${carType}ìš© ${occupation \u003d\u003d\u003d \u0027ìì˜ì—…\u0027 ? \u0027ì—…ë¬´ìš© ì°¨ëŸ‰ë„ ë³´ì¥ ê°€ëŠ¥í•œ\u0027 : \u0027\u0027} ìƒí’ˆì„ í™•ì¸í•˜ë ¤ë©´ ì§€ì  ë°©ë¬¸(www.hi.co.kr) ë˜ëŠ” 1588-5656ìœ¼ë¡œ ì—°ë½ ì£¼ì„¸ìš”!`;\n        }\n        break;\n        \n      case \u0027medical_insurance\u0027:\n        const coverageType \u003d entities.coverage_type || \u0027ë³´ì¥\u0027;\n        if (age \u003e\u003d 30 \u0026\u0026 age \u003c 50) {\n          response \u003d `${occupation} ê³ ê°ë‹˜ê»˜ ê°€ì¡± ì¤‘ì‹¬ ì‹¤ì†ì˜ë£Œë³´í—˜ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ${coverageType} í¬í•¨ ${income \u003e\u003d 500 ? \u0027í¬ê´„ì ì¸ ë³´ì¥\u0027 : \u0027í•©ë¦¬ì ì¸ ë³´ì¥\u0027}ì˜ íŒ¨ë°€ë¦¬ í”Œëœì„ www.hi.co.krì—ì„œ í™•ì¸í•˜ì„¸ìš”. ${insuranceExperience.includes(\u0027ì‹¤ì†\u0027) ? \u0027ê¸°ì¡´ ì‹¤ì†ë³´í—˜ê³¼ì˜ ì¤‘ë³µ ì—¬ë¶€ë„ ê²€í† í•´ ë“œë¦½ë‹ˆë‹¤!\u0027 : \u0027\u0027}`;\n        } else {\n          response \u003d `ê³ ê°ë‹˜ì˜ ê±´ê°•ì„ ìœ„í•œ ì‹¤ì†ì˜ë£Œë³´í—˜ì…ë‹ˆë‹¤. ${coverageType} í¬í•¨ ${age \u003e\u003d 50 ? \u0027ê³ ë ¹ì ë§ì¶¤ ë³´ì¥\u0027 : \u0027ì—°ë ¹ëŒ€ë³„ ë§ì¶¤ ë³´ì¥\u0027}ê³¼ ëª¨ë°”ì¼ ì²­êµ¬ ë°©ë²•ì„ www.hi.co.krì—ì„œ í™•ì¸í•´ ë³´ì„¸ìš”!`;\n        }\n        break;\n        \n      case \u0027consultation\u0027:\n        const consultationType \u003d entities.consultation_type || \u0027ìƒë‹´\u0027;\n        if (age \u003e\u003d 20 \u0026\u0026 age \u003c 30) {\n          response \u003d `20ëŒ€ ${occupation} ê³ ê°ë‹˜ê»˜ ë¹ ë¥¸ ${consultationType}ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. www.hi.co.krì—ì„œ í™”ìƒ ìƒë‹´ì„ ì˜ˆì•½í•˜ì„¸ìš”! ${insuranceExperience \u003d\u003d\u003d \u0027ì—†ìŒ\u0027 ? \u0027ë³´í—˜ ê°€ì…ì´ ì²˜ìŒì´ì‹œë¼ë©´ ê°„ë‹¨íˆ ì„¤ëª…ë“œë¦´ê²Œìš”.\u0027 : \u0027\u0027}`;\n        } else if (age \u003e\u003d 30 \u0026\u0026 age \u003c 50) {\n          response \u003d `${occupation} ê³ ê°ë‹˜ê»˜ ì „ë¬¸ ìƒë‹´ì‚¬ì™€ì˜ ${consultationType}(1588-5656) ë˜ëŠ” ì§€ì  ë°©ë¬¸ ì˜ˆì•½ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ${income \u003e\u003d 500 ? \u0027í”„ë¦¬ë¯¸ì—„ ìƒë‹´ ì„œë¹„ìŠ¤ë„ ì œê³µë©ë‹ˆë‹¤!\u0027 : \u0027\u0027}`;\n        } else {\n          response \u003d `${consultationType}ì„ ì„ í˜¸í•˜ì‹œëŠ” ê³ ê°ë‹˜ê»˜ ê°€ê¹Œìš´ í˜„ëŒ€í•´ìƒ ì§€ì ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤. ì§€ì  ìœ„ì¹˜ëŠ” www.hi.co.krì—ì„œ í™•ì¸í•˜ì„¸ìš”.`;\n        }\n        break;\n        \n      case \u0027premium_calculation\u0027:\n        const insuranceType \u003d entities.insurance_type || \u0027ë³´í—˜\u0027;\n        if (age \u003e\u003d 20 \u0026\u0026 age \u003c 30) {\n          response \u003d `20ëŒ€ ${occupation} ê³ ê°ë‹˜ê»˜ ê°„í¸í•œ ë³´í—˜ë£Œ ê³„ì‚°ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. www.hi.co.krì—ì„œ ${insuranceType} ì˜ˆìƒ ë³´í—˜ë£Œë¥¼ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”!`;\n        } else {\n          response \u003d `ë³´í—˜ë£Œ ê³„ì‚°ì€ www.hi.co.krì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ${occupation} ê³ ê°ë‹˜ì˜ ${income \u003e\u003d 500 ? \u0027ê³ ì†Œë“\u0027 : \u0027í”„ë¡œí•„\u0027}ì— ë§ì¶˜ ${insuranceType} ê²¬ì ì„ ë°›ì•„ë³´ì„¸ìš”.`;\n        }\n        break;\n        \n      case \u0027recommended_product\u0027:\n        const userPreference \u003d entities.user_preference || \u0027ë§ì¶¤ ìƒí’ˆ\u0027;\n        if (age \u003e\u003d 30 \u0026\u0026 age \u003c 50) {\n          response \u003d `${occupation} ê³ ê°ë‹˜ê»˜ ê°€ì¡± ì¤‘ì‹¬ ì‹¤ì†ì˜ë£Œë³´í—˜ê³¼ ìë™ì°¨ë³´í—˜ ê²°í•© í• ì¸ ${userPreference}ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ${income \u003e\u003d 500 ? \u0027í”„ë¦¬ë¯¸ì—„ ë³´ì¥ ì˜µì…˜\u0027 : \u0027í•©ë¦¬ì ì¸ ë³´ì¥ ì˜µì…˜\u0027}ì„ www.hi.co.krì—ì„œ í™•ì¸í•˜ì„¸ìš”!`;\n        } else {\n          response \u003d `${interest !\u003d\u003d \u0027ë¯¸ì •/ìƒë‹´í•„ìš”\u0027 ? `${interest} ê´€ë ¨` : \u0027\u0027} ${userPreference}ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. www.hi.co.krì—ì„œ ë‹¤ì–‘í•œ ìƒí’ˆì„ ë¹„êµí•´ ë³´ì„¸ìš”!`;\n        }\n        break;\n        \n      case \u0027branch_info\u0027:\n        const location \u003d entities.location || \u0027ì§€ì \u0027;\n        response \u003d `í˜„ëŒ€í•´ìƒ ${location} ìœ„ì¹˜ëŠ” www.hi.co.krì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤. ${occupation \u003d\u003d\u003d \u0027ìì˜ì—…\u0027 ? \u0027ì—…ë¬´ìš© ìƒë‹´ì´ í•„ìš”í•˜ì‹œë©´\u0027 : \u0027\u0027} ê³ ê°ì„¼í„°(1588-5656)ë¡œ ë¬¸ì˜ ì£¼ì„¸ìš”.`;\n        break;\n        \n      case \u0027feedback\u0027:\n        response \u003d `í”¼ë“œë°±ì„ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ${userInput.includes(\u0027ë§Œì¡±\u0027) ? \u0027ë§Œì¡±í•˜ì…¨ë‹¤ë‹ˆ ê¸°ì©ë‹ˆë‹¤!\u0027 : userInput.includes(\u0027ë¶ˆë§Œì¡±\u0027) ? \u0027ë¶ˆí¸í•˜ì…¨ë˜ ì ì„ ê°œì„ í•˜ê² ìŠµë‹ˆë‹¤.\u0027 : \u0027ì˜ê²¬ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\u0027} ì¶”ê°€ë¡œ ë„ì™€ë“œë¦´ê¹Œìš”?`;\n        saveFeedback(userId, userProfile.name, userInput);\n        updateIntentWeights(); // Update weights based on feedback\n        break;\n        \n      default:\n        response \u003d getBotReply(userInput);\n    }\n    \n    // Save bot response to history\n    saveChatHistory(userId, \u0027HiCareBot\u0027, response, \u0027bot\u0027);\n    \n    return response + disclaimer;\n  } catch (error) {\n    logError(error, \u0027processUserInput\u0027);\n    return `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${sanitizeInput(error.message)}. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\\n\\n* ë³¸ ì •ë³´ëŠ” ë²•ì  êµ¬ì†ë ¥ì´ ì—†ìœ¼ë©°, ì •í™•í•œ ë‚´ìš©ì€ ìƒë‹´ì›ì„ í†µí•´ í™•ì¸í•´ ì£¼ì„¸ìš”.`;\n  }\n}\n\nfunction getBotReply(userInput) {\n  userInput \u003d sanitizeInput(userInput).toLowerCase();\n  let reply \u003d \u0027\u0027;\n  \n  if (userInput.includes(\u0027ë³´í—˜ë£Œ\u0027)) {\n    reply \u003d \u0027ğŸš— ìë™ì°¨ ë³´í—˜ë£Œ ê³„ì‚°ì„ ë„ì™€ë“œë¦´ê²Œìš”! ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ www.hi.co.krì—ì„œ ê°„í¸í•˜ê²Œ ê²¬ì ì„ í™•ì¸í•˜ì„¸ìš”.\u0027;\n  } else if (userInput.includes(\u0027ìƒë‹´\u0027)) {\n    reply \u003d \u0027ğŸ’¬ ì „ë¬¸ ìƒë‹´ì› ì—°ê²°ì„ ì›í•˜ì‹œë‚˜ìš”? ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ 1588-5656ìœ¼ë¡œ ì „í™” ì£¼ì‹œê±°ë‚˜ www.hi.co.krì—ì„œ ì˜ˆì•½í•˜ì„¸ìš”!\u0027;\n  } else {\n    reply \u003d \u0027ğŸ¤– í•˜ì´ì¼€ì–´ë´‡ì´ ì˜ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìë™ì°¨ë³´í—˜, ì‹¤ì†ë³´í—˜, ìƒë‹´ ì˜ˆì•½ ë“±ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!\u0027;\n  }\n  \n  return reply;\n}\n\nfunction saveUserProfile(userProfile) {\n  try {\n    // Sanitize profile fields\n    const sanitizedProfile \u003d {\n      name: sanitizeInput(userProfile.name),\n      gender: sanitizeInput(userProfile.gender),\n      age: parseInt(userProfile.age) || 30,\n      occupation: sanitizeInput(userProfile.occupation),\n      income: parseInt(userProfile.income) || 0,\n      insuranceExperience: sanitizeInput(userProfile.insuranceExperience),\n      interest: sanitizeInput(userProfile.interest)\n    };\n    \n    return { success: true, message: \u0027í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\u0027 };\n  } catch (error) {\n    logError(error, \u0027saveUserProfile\u0027);\n    return { success: false, message: \u0027í”„ë¡œí•„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\u0027 };\n  }\n}\n\nfunction saveChatHistory(userId, sender, message, type) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const sheet \u003d ss.getSheetByName(CHAT_SHEET_NAME) || ss.insertSheet(CHAT_SHEET_NAME);\n    const timestamp \u003d new Date().toISOString();\n    sheet.appendRow([timestamp, userId, sender, sanitizeInput(message), type]);\n  } catch (error) {\n    logError(error, \u0027saveChatHistory\u0027);\n  }\n}\n\nfunction saveFeedback(userId, userName, feedback) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const sheet \u003d ss.getSheetByName(FEEDBACK_SHEET_NAME) || ss.insertSheet(FEEDBACK_SHEET_NAME);\n    const timestamp \u003d new Date().toISOString();\n    sheet.appendRow([timestamp, userId, userName, sanitizeInput(feedback)]);\n  } catch (error) {\n    logError(error, \u0027saveFeedback\u0027);\n  }\n}\n\nfunction loadFileData(fileName) {\n  try {\n    const files \u003d DriveApp.getFilesByName(fileName);\n    if (!files.hasNext()) {\n      throw new Error(`File ${fileName} not found in Google Drive.`);\n    }\n    const file \u003d files.next();\n    return file.getBlob().getDataAsString();\n  } catch (error) {\n    logError(error, \u0027loadFileData\u0027);\n    return \u0027\u0027; // Fallback to empty string to prevent frontend crash\n  }\n}\n\nfunction getChatHistory(userId) {\n  try {\n    const ss \u003d SpreadsheetApp.openById(SPREADSHEET_ID);\n    const sheet \u003d ss.getSheetByName(CHAT_SHEET_NAME);\n    if (!sheet) return [];\n    \n    const data \u003d sheet.getDataRange().getValues();\n    const history \u003d data.slice(1).filter(row \u003d\u003e row[1] \u003d\u003d\u003d userId).map(row \u003d\u003e ({\n      timestamp: row[0],\n      sender: row[2],\n      message: row[3],\n      type: row[4]\n    }));\n    \n    return history;\n  } catch (error) {\n    logError(error, \u0027getChatHistory\u0027);\n    return [];\n  }\n}"},{"id":"1b72851d-66d3-4610-9248-84368c8321d6","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n  \u003cmeta charset\u003d\"UTF-8\"\u003e\n  \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\"\u003e\n  \u003ctitle\u003eí˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´ë´‡\u003c/title\u003e\n  \u003cscript src\u003d\"https://unpkg.com/papaparse@latest/papaparse.min.js\"\u003e\u003c/script\u003e\n  \u003clink href\u003d\"https://fonts.googleapis.com/css2?family\u003dNoto+Sans+KR:wght@400;700\u0026family\u003dPretendard:wght@400;600\u0026display\u003dswap\" rel\u003d\"stylesheet\"\u003e\n  \u003cstyle\u003e\n    body {\n      font-family: \u0027Pretendard\u0027, \u0027Noto Sans KR\u0027, sans-serif;\n      margin: 0;\n      padding: 20px;\n      background-color: #F9FAFB;\n      color: #333;\n    }\n    \n    .container {\n      max-width: 600px;\n      margin: 0 auto;\n      padding: 20px;\n      background-color: #fff;\n      border-radius: 12px;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    }\n    \n    .header {\n      text-align: center;\n      padding: 10px 0;\n      border-bottom: 1px solid #eee;\n    }\n    \n    .header img {\n      height: 40px;\n      margin-bottom: 10px;\n    }\n    \n    .header h1 {\n      color: #005BAC;\n      margin: 0;\n      font-size: 24px;\n    }\n    \n    .chat-container {\n      height: 400px;\n      overflow-y: auto;\n      padding: 10px;\n      margin: 20px 0;\n      border: 1px solid #E5E7EB;\n      border-radius: 12px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n    \n    .message {\n      display: flex;\n      align-items: flex-end;\n      gap: 10px;\n    }\n    \n    .message.bot {\n      flex-direction: row;\n    }\n    \n    .message.user {\n      flex-direction: row-reverse;\n    }\n    \n    .avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      object-fit: cover;\n    }\n    \n    .bubble {\n      padding: 10px 14px;\n      border-radius: 18px;\n      max-width: 70%;\n      line-height: 1.4;\n      position: relative;\n      word-wrap: break-word;\n    }\n    \n    .bubble.bot {\n      background-color: #e1f5fe;\n      color: #003c8f;\n      text-align: left;\n    }\n    \n    .bubble.user {\n      background-color: #c8e6c9;\n      color: #1b5e20;\n      text-align: right;\n      margin-left: auto;\n    }\n    \n    .bubble.bot::after {\n      content: \u0027\u0027;\n      position: absolute;\n      top: 10px;\n      left: -8px;\n      width: 0;\n      height: 0;\n      border-top: 8px solid transparent;\n      border-bottom: 8px solid transparent;\n      border-right: 8px solid #e1f5fe;\n    }\n    \n    .bubble.user::after {\n      content: \u0027\u0027;\n      position: absolute;\n      top: 10px;\n      right: -8px;\n      width: 0;\n      height: 0;\n      border-top: 8px solid transparent;\n      border-bottom: 8px solid transparent;\n      border-left: 8px solid #c8e6c9;\n    }\n    \n    .input-area {\n      display: flex;\n      margin-top: 20px;\n      justify-content: center;\n      position: relative;\n    }\n    \n    #user-input {\n      flex: 1;\n      max-width: 85%;\n      padding: 10px;\n      border: 1px solid #ccc;\n      border-radius: 8px;\n      outline: none;\n    }\n    \n    #user-input:focus {\n      border-color: #005BAC;\n      box-shadow: 0 0 5px rgba(0, 91, 172, 0.3);\n    }\n    \n    button {\n      background-color: #005BAC;\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      margin-left: 10px;\n      border-radius: 8px;\n      cursor: pointer;\n      font-weight: bold;\n    }\n    \n    button:hover {\n      background-color: #004d8c;\n    }\n    \n    button:focus {\n      outline: 2px solid #005BAC;\n      outline-offset: 2px;\n    }\n    \n    .profile-form {\n      margin-top: 20px;\n      padding: 15px;\n      border: 1px solid #E5E7EB;\n      border-radius: 8px;\n    }\n    \n    .form-group {\n      margin-bottom: 15px;\n    }\n    \n    .form-group label {\n      display: block;\n      margin-bottom: 5px;\n      font-weight: bold;\n    }\n    \n    .form-group input, .form-group select {\n      width: 100%;\n      padding: 8px;\n      border: 1px solid #E5E7EB;\n      border-radius: 4px;\n    }\n    \n    .form-group input:focus, .form-group select:focus {\n      border-color: #005BAC;\n      outline: none;\n    }\n    \n    .form-error {\n      color: #D32F2F;\n      font-size: 12px;\n      margin-top: 5px;\n      display: none;\n    }\n    \n    .welcome-screen {\n      text-align: center;\n      padding: 30px 0;\n    }\n    \n    .welcome-screen img {\n      width: 150px;\n      margin-bottom: 20px;\n    }\n    \n    .welcome-screen h2 {\n      color: #005BAC;\n      margin-bottom: 20px;\n    }\n    \n    .welcome-screen p {\n      margin-bottom: 30px;\n      color: #666;\n    }\n    \n    .start-button {\n      background-color: #005BAC;\n      color: white;\n      border: none;\n      padding: 12px 30px;\n      border-radius: 25px;\n      font-size: 16px;\n      cursor: pointer;\n      transition: background-color 0.3s;\n    }\n    \n    .start-button:hover {\n      background-color: #004d8c;\n    }\n    \n    .start-button:focus {\n      outline: 2px solid #005BAC;\n      outline-offset: 2px;\n    }\n    \n    .hidden {\n      display: none;\n    }\n    \n    .quick-buttons {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n      margin-top: 15px;\n      justify-content: center;\n    }\n    \n    .quick-button {\n      background-color: #F0F8FF;\n      border: 1px solid #005BAC;\n      color: #005BAC;\n      padding: 8px 15px;\n      border-radius: 20px;\n      cursor: pointer;\n      font-size: 14px;\n      transition: all 0.3s;\n    }\n    \n    .quick-button:hover {\n      background-color: #005BAC;\n      color: white;\n    }\n    \n    .quick-button:focus {\n      outline: 2px solid #005BAC;\n      outline-offset: 2px;\n    }\n    \n    .category-buttons {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 10px;\n      margin: 20px 0;\n    }\n    \n    .category-button {\n      background-color: #fff;\n      border: 1px solid #E5E7EB;\n      border-radius: 10px;\n      padding: 15px 10px;\n      text-align: center;\n      cursor: pointer;\n      transition: all 0.3s;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n    }\n    \n    .category-button:hover {\n      border-color: #005BAC;\n      box-shadow: 0 2px 8px rgba(0, 91, 172, 0.2);\n    }\n    \n    .category-button:focus {\n      outline: 2px solid #005BAC;\n      outline-offset: 2px;\n    }\n    \n    .category-icon {\n      width: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      background-size: contain;\n      background-repeat: no-repeat;\n      background-position: center;\n    }\n    \n    .category-title {\n      font-weight: bold;\n      color: #333;\n      margin-bottom: 5px;\n    }\n    \n    .category-desc {\n      font-size: 12px;\n      color: #666;\n    }\n    \n    .typing-indicator {\n      display: inline-block;\n      padding: 8px 15px;\n      background-color: #e1f5fe;\n      border-radius: 12px;\n    }\n    \n    .typing-indicator span {\n      display: inline-block;\n      width: 8px;\n      height: 8px;\n      background-color: #005BAC;\n      border-radius: 50%;\n      animation: typing 1s infinite;\n      margin: 0 2px;\n    }\n    \n    .typing-indicator span:nth-child(2) {\n      animation-delay: 0.2s;\n    }\n    \n    .typing-indicator span:nth-child(3) {\n      animation-delay: 0.4s;\n    }\n    \n    @keyframes typing {\n      0%, 100% { transform: translateY(0); }\n      50% { transform: translateY(-5px); }\n    }\n    \n    #disclaimer {\n      font-size: 10px;\n      color: #666;\n      text-align: center;\n      margin-top: 10px;\n    }\n    \n    .error-message {\n      color: #D32F2F;\n      text-align: center;\n      margin: 10px 0;\n    }\n    \n    .loading-indicator {\n      text-align: center;\n      margin: 10px 0;\n      color: #005BAC;\n      font-size: 14px;\n    }\n    \n    .autocomplete-suggestions {\n      position: absolute;\n      top: 100%;\n      left: 0;\n      right: 0;\n      background: #fff;\n      border: 1px solid #E5E7EB;\n      border-radius: 8px;\n      max-height: 150px;\n      overflow-y: auto;\n      z-index: 10;\n      display: none;\n    }\n    \n    .autocomplete-suggestion {\n      padding: 10px;\n      cursor: pointer;\n      color: #333;\n    }\n    \n    .autocomplete-suggestion:hover {\n      background-color: #F0F8FF;\n    }\n    \n    .feedback-button, .save-log-button {\n      background-color: #F0F8FF;\n      border: 1px solid #005BAC;\n      color: #005BAC;\n      padding: 8px 15px;\n      border-radius: 20px;\n      cursor: pointer;\n      font-size: 14px;\n      margin-top: 10px;\n      margin-right: 10px;\n      display: inline-block;\n    }\n    \n    .feedback-button:hover, .save-log-button:hover {\n      background-color: #005BAC;\n      color: white;\n    }\n    \n    .feedback-button:focus, .save-log-button:focus {\n      outline: 2px solid #005BAC;\n      outline-offset: 2px;\n    }\n  \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n  \u003cdiv class\u003d\"container\"\u003e\n    \u003c!-- ì‹œì‘ í™”ë©´ --\u003e\n    \u003cdiv id\u003d\"welcome-screen\" class\u003d\"welcome-screen\"\u003e\n      \u003cimg src\u003d\"https://www.hi.co.kr/images/main/logo.png\" alt\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \" role\u003d\"img\" aria-label\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \"\u003e\n      \u003ch2\u003eí˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´(Hi-Care) ë´‡\u003c/h2\u003e\n      \u003cp\u003eê³ ê°ë‹˜ì˜ ìƒí™©ì— ë§ëŠ” ë§ì¶¤í˜• ë³´í—˜ ìƒë‹´ì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤.\u003c/p\u003e\n      \u003cbutton id\u003d\"start-button\" class\u003d\"start-button\" role\u003d\"button\" aria-label\u003d\"ìƒë‹´ ì‹œì‘í•˜ê¸°\"\u003eìƒë‹´ ì‹œì‘í•˜ê¸°\u003c/button\u003e\n    \u003c/div\u003e\n    \n    \u003c!-- í”„ë¡œí•„ ì…ë ¥ í™”ë©´ --\u003e\n    \u003cdiv id\u003d\"profile-screen\" class\u003d\"hidden\" role\u003d\"form\" aria-label\u003d\"ê³ ê° ì •ë³´ ì…ë ¥ í¼\"\u003e\n      \u003cdiv class\u003d\"header\"\u003e\n        \u003cimg src\u003d\"https://www.hi.co.kr/images/main/logo.png\" alt\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \" role\u003d\"img\" aria-label\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \"\u003e\n        \u003ch1\u003eí•˜ì´ì¼€ì–´(Hi-Care)ë´‡ê³¼ í•¨ê»˜í•˜ëŠ” ë§ì¶¤í˜• ìƒë‹´\u003c/h1\u003e\n      \u003c/div\u003e\n      \n      \u003cdiv class\u003d\"profile-form\"\u003e\n        \u003ch2\u003eê³ ê° ì •ë³´ ì…ë ¥\u003c/h2\u003e\n        \u003cp\u003eë” ì •í™•í•œ ë§ì¶¤í˜• ìƒë‹´ì„ ìœ„í•´ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\u003c/p\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"name\"\u003eì´ë¦„\u003c/label\u003e\n          \u003cinput type\u003d\"text\" id\u003d\"name\" placeholder\u003d\"ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”\" aria-required\u003d\"true\"\u003e\n          \u003cdiv id\u003d\"name-error\" class\u003d\"form-error\"\u003eì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (2~50ì).\u003c/div\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"gender\"\u003eì„±ë³„\u003c/label\u003e\n          \u003cselect id\u003d\"gender\" aria-required\u003d\"true\"\u003e\n            \u003coption value\u003d\"\"\u003eì„ íƒí•˜ì„¸ìš”\u003c/option\u003e\n            \u003coption value\u003d\"ë‚¨ì„±\"\u003eë‚¨ì„±\u003c/option\u003e\n            \u003coption value\u003d\"ì—¬ì„±\"\u003eì—¬ì„±\u003c/option\u003e\n          \u003c/select\u003e\n          \u003cdiv id\u003d\"gender-error\" class\u003d\"form-error\"\u003eì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\u003c/div\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"age\"\u003eì—°ë ¹\u003c/label\u003e\n          \u003cinput type\u003d\"number\" id\u003d\"age\" placeholder\u003d\"ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”\" min\u003d\"18\" max\u003d\"100\" aria-required\u003d\"true\"\u003e\n          \u003cdiv id\u003d\"age-error\" class\u003d\"form-error\"\u003e18ì„¸ ì´ìƒ 100ì„¸ ì´í•˜ì˜ ë‚˜ì´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.\u003c/div\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"occupation\"\u003eì§ì—…\u003c/label\u003e\n          \u003cselect id\u003d\"occupation\" aria-required\u003d\"true\"\u003e\n            \u003coption value\u003d\"\"\u003eì„ íƒí•˜ì„¸ìš”\u003c/option\u003e\n            \u003coption value\u003d\"ì‚¬ë¬´ì§\"\u003eì‚¬ë¬´ì§\u003c/option\u003e\n            \u003coption value\u003d\"ì „ë¬¸ì§\"\u003eì „ë¬¸ì§\u003c/option\u003e\n            \u003coption value\u003d\"ìì˜ì—…\"\u003eìì˜ì—…\u003c/option\u003e\n            \u003coption value\u003d\"í•™ìƒ\"\u003eí•™ìƒ\u003c/option\u003e\n            \u003coption value\u003d\"ê¸°íƒ€\"\u003eê¸°íƒ€\u003c/option\u003e\n          \u003c/select\u003e\n          \u003cdiv id\u003d\"occupation-error\" class\u003d\"form-error\"\u003eì§ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\u003c/div\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"income\"\u003eì—°ì†Œë“ (ë§Œ ì›)\u003c/label\u003e\n          \u003cselect id\u003d\"income\"\u003e\n            \u003coption value\u003d\"\"\u003eì„ íƒí•˜ì„¸ìš”\u003c/option\u003e\n            \u003coption value\u003d\"100\"\u003e3000ì´í•˜\u003c/option\u003e\n            \u003coption value\u003d\"300\"\u003e3000ì´ìƒ ~ 5000ë¯¸ë§Œ\u003c/option\u003e\n            \u003coption value\u003d\"500\"\u003e5000ì´ìƒ ~ 7000ë¯¸ë§Œ\u003c/option\u003e\n            \u003coption value\u003d\"1000\"\u003e7000ì´ìƒ\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"insurance-experience\"\u003eë³´í—˜ ê°€ì… ê²½í—˜\u003c/label\u003e\n          \u003cselect id\u003d\"insurance-experience\"\u003e\n            \u003coption value\u003d\"\"\u003eì„ íƒí•˜ì„¸ìš”\u003c/option\u003e\n            \u003coption value\u003d\"ì—†ìŒ\"\u003eì—†ìŒ\u003c/option\u003e\n            \u003coption value\u003d\"ìë™ì°¨ë³´í—˜ë§Œ\"\u003eìë™ì°¨ë³´í—˜ë§Œ\u003c/option\u003e\n            \u003coption value\u003d\"ì‹¤ì†ë³´í—˜ë§Œ\"\u003eì‹¤ì†ë³´í—˜ë§Œ\u003c/option\u003e\n            \u003coption value\u003d\"ë‹¤ì–‘í•œ ë³´í—˜ ê°€ì…\"\u003eë‹¤ì–‘í•œ ë³´í—˜ ê°€ì…\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv class\u003d\"form-group\"\u003e\n          \u003clabel for\u003d\"interest\"\u003eê´€ì‹¬ ìˆëŠ” ë³´í—˜ ìƒí’ˆ\u003c/label\u003e\n          \u003cselect id\u003d\"interest\"\u003e\n            \u003coption value\u003d\"\"\u003eì„ íƒí•˜ì„¸ìš”\u003c/option\u003e\n            \u003coption value\u003d\"ìë™ì°¨ë³´í—˜\"\u003eìë™ì°¨ë³´í—˜\u003c/option\u003e\n            \u003coption value\u003d\"ì‹¤ì†ë³´í—˜\"\u003eì‹¤ì†ë³´í—˜\u003c/option\u003e\n            \u003coption value\u003d\"ë¯¸ì •/ìƒë‹´í•„ìš”\"\u003eë¯¸ì •/ìƒë‹´í•„ìš”\u003c/option\u003e\n          \u003c/select\u003e\n        \u003c/div\u003e\n        \n        \u003cbutton id\u003d\"submit-profile\" role\u003d\"button\" aria-label\u003d\"ìƒë‹´ ì‹œì‘í•˜ê¸°\"\u003eìƒë‹´ ì‹œì‘í•˜ê¸°\u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \n    \u003c!-- ì±—ë´‡ í™”ë©´ --\u003e\n    \u003cdiv id\u003d\"chat-screen\" class\u003d\"hidden\" role\u003d\"region\" aria-label\u003d\"ì±—ë´‡ ëŒ€í™” í™”ë©´\"\u003e\n      \u003cdiv class\u003d\"header\"\u003e\n        \u003cimg src\u003d\"https://www.hi.co.kr/images/main/logo.png\" alt\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \" role\u003d\"img\" aria-label\u003d\"í˜„ëŒ€í•´ìƒ ë¡œê³ \"\u003e\n        \u003ch1\u003eí•˜ì´ì¼€ì–´(Hi-Care) ë´‡\u003c/h1\u003e\n      \u003c/div\u003e\n      \n      \u003cdiv id\u003d\"chat-container\" class\u003d\"chat-container\" role\u003d\"log\" aria-live\u003d\"polite\"\u003e\n        \u003c!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ --\u003e\n        \u003cdiv id\u003d\"loading-indicator\" class\u003d\"loading-indicator hidden\"\u003eë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...\u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì˜ì—­ --\u003e\n      \u003cdiv id\u003d\"category-buttons\" class\u003d\"category-buttons\" role\u003d\"navigation\" aria-label\u003d\"ë³´í—˜ ì¹´í…Œê³ ë¦¬ ì„ íƒ\"\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ìë™ì°¨ë³´í—˜\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ìë™ì°¨ë³´í—˜: ìë™ì°¨/ì´ë¥œì°¨/ìš´ì „ì\"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_car.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eìë™ì°¨ë³´í—˜\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eìë™ì°¨/ì´ë¥œì°¨/ìš´ì „ì\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ì‹¤ì†ì˜ë£Œë³´í—˜\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ì‹¤ì†ì˜ë£Œë³´í—˜: ì‹¤ì†/ê±´ê°•\"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_health.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eì‹¤ì†ì˜ë£Œë³´í—˜\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eì‹¤ì†/ê±´ê°•\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ìƒë‹´ì˜ˆì•½\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ìƒë‹´ì˜ˆì•½: ì „í™”/í™”ìƒ ìƒë‹´\"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_consult.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eìƒë‹´ì˜ˆì•½\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eì „í™”/í™”ìƒ ìƒë‹´\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ë³´í—˜ë£Œê³„ì‚°\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ë³´í—˜ë£Œê³„ì‚°: ê²¬ì  í™•ì¸\"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_calculate.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eë³´í—˜ë£Œê³„ì‚°\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eê²¬ì  í™•ì¸\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ì¶”ì²œìƒí’ˆ\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ì¶”ì²œìƒí’ˆ: ë§ì¶¤ ì¶”ì²œ\"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_recommend.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eì¶”ì²œìƒí’ˆ\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eë§ì¶¤ ì¶”ì²œ\u003c/div\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"category-button\" data-category\u003d\"ì§€ì ì•ˆë‚´\" role\u003d\"button\" tabindex\u003d\"0\" aria-label\u003d\"ì§€ì ì•ˆë‚´: ìµœê·¼ ì§€ì \"\u003e\n          \u003cdiv class\u003d\"category-icon\" style\u003d\"background-image: url(\u0027https://www.hi.co.kr/images/main/icon_location.png\u0027);\"\u003e\u003c/div\u003e\n          \u003cdiv class\u003d\"category-title\"\u003eì§€ì ì•ˆë‚´\u003c/div\u003e\n          \u003cdiv class\u003d\"category-desc\"\u003eìµœê·¼ ì§€ì \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- í€µë²„íŠ¼ ì˜ì—­ --\u003e\n      \u003cdiv id\u003d\"quick-buttons\" class\u003d\"quick-buttons\" role\u003d\"navigation\" aria-label\u003d\"ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼\"\u003e\n        \u003c!-- í€µë²„íŠ¼ì€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ --\u003e\n      \u003c/div\u003e\n      \n      \u003cdiv class\u003d\"input-area\"\u003e\n        \u003cinput type\u003d\"text\" id\u003d\"user-input\" placeholder\u003d\"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...\" role\u003d\"textbox\" aria-label\u003d\"ë©”ì‹œì§€ ì…ë ¥\" autocomplete\u003d\"off\"\u003e\n        \u003cdiv id\u003d\"autocomplete-suggestions\" class\u003d\"autocomplete-suggestions\"\u003e\u003c/div\u003e\n        \u003cbutton id\u003d\"send-button\" role\u003d\"button\" aria-label\u003d\"ë©”ì‹œì§€ ë³´ë‚´ê¸°\"\u003eë³´ë‚´ê¸°\u003c/button\u003e\n      \u003c/div\u003e\n      \n      \u003cbutton id\u003d\"feedback-button\" class\u003d\"feedback-button\" role\u003d\"button\" aria-label\u003d\"í”¼ë“œë°± ì œê³µ\"\u003eí”¼ë“œë°± ì œê³µ\u003c/button\u003e\n      \u003cbutton id\u003d\"save-log-button\" class\u003d\"save-log-button\" role\u003d\"button\" aria-label\u003d\"ëŒ€í™” ë¡œê·¸ ì €ì¥\"\u003eëŒ€í™” ë¡œê·¸ ì €ì¥\u003c/button\u003e\n    \u003c/div\u003e\n    \n    \u003cdiv id\u003d\"disclaimer\"\u003eë²•ì  êµ¬ì†ë ¥ ì—†ëŠ” ì •ë³´ë¡œ, ìƒë‹´ì› í™•ì¸ ê¶Œì¥\u003c/div\u003e\n  \u003c/div\u003e\n\n  \u003cscript\u003e\n    // Initializing user profile\n    let userProfile \u003d {\n      name: \"\",\n      gender: \"\",\n      age: 0,\n      occupation: \"\",\n      income: 0,\n      insuranceExperience: \"\",\n      interest: \"\"\n    };\n    \n    // Defining insurance products\n    const insuranceProducts \u003d {\n      \"ìë™ì°¨ë³´í—˜\": {\n        description: \"ìë™ì°¨ ì‚¬ê³ ë¡œ ì¸í•œ ì†í•´ë¥¼ ë³´ìƒí•˜ëŠ” ìƒí’ˆì…ë‹ˆë‹¤.\",\n        subCategories: [\"ìë™ì°¨ë³´í—˜\", \"ì´ë¥œì°¨ë³´í—˜\", \"ìš´ì „ìë³´í—˜\"],\n        quickButtons: [\"ìë™ì°¨ë³´í—˜ ê²¬ì \", \"ì´ë¥œì°¨ë³´í—˜ ì•ˆë‚´\", \"ìš´ì „ìë³´í—˜ ìƒë‹´\"]\n      },\n      \"ì‹¤ì†ì˜ë£Œë³´í—˜\": {\n        description: \"ì˜ë£Œë¹„ë¥¼ ë³´ì¥í•˜ëŠ” ì‹¤ì†ì˜ë£Œë³´í—˜ ìƒí’ˆì…ë‹ˆë‹¤.\",\n        subCategories: [\"ì‹¤ì†ë³´í—˜\", \"ê±´ê°•ë³´í—˜\"],\n        quickButtons: [\"ì‹¤ì†ë³´í—˜ ì•ˆë‚´\", \"ê±´ê°•ë³´í—˜ ìƒë‹´\"]\n      },\n      \"ìƒë‹´ì˜ˆì•½\": {\n        description: \"ì „í™” ë˜ëŠ” í™”ìƒ ìƒë‹´ ì˜ˆì•½ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.\",\n        subCategories: [\"ì „í™” ìƒë‹´\", \"í™”ìƒ ìƒë‹´\"],\n        quickButtons: [\"ì „í™” ìƒë‹´ ì˜ˆì•½\", \"í™”ìƒ ìƒë‹´ ì˜ˆì•½\"]\n      },\n      \"ë³´í—˜ë£Œê³„ì‚°\": {\n        description: \"ë³´í—˜ë£Œ ê²¬ì ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\",\n        subCategories: [\"ìë™ì°¨ë³´í—˜ ê²¬ì \", \"ì‹¤ì†ë³´í—˜ ê²¬ì \"],\n        quickButtons: [\"ìë™ì°¨ë³´í—˜ ê²¬ì \", \"ì‹¤ì†ë³´í—˜ ê²¬ì \"]\n      },\n      \"ì¶”ì²œìƒí’ˆ\": {\n        description: \"ê³ ê°ë‹˜ê»˜ ë§ëŠ” ë³´í—˜ ìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤.\",\n        subCategories: [\"ë§ì¶¤ ì¶”ì²œ\", \"ê°€ì¡± ë³´í—˜\"],\n        quickButtons: [\"ë§ì¶¤ ì¶”ì²œ ë°›ê¸°\", \"ê°€ì¡± ë³´í—˜ ì•ˆë‚´\"]\n      },\n      \"ì§€ì ì•ˆë‚´\": {\n        description: \"ê°€ê¹Œìš´ ì§€ì  ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.\",\n        subCategories: [\"ì§€ì  ìœ„ì¹˜\", \"ë°©ë¬¸ ì˜ˆì•½\"],\n        quickButtons: [\"ì§€ì  ìœ„ì¹˜ ì•ˆë‚´\", \"ë°©ë¬¸ ì˜ˆì•½\"]\n      }\n    };\n    \n    // Storing persona data\n    let personaData \u003d [];\n    \n    // Autocomplete suggestions\n    const autocompleteSuggestions \u003d [\n      \"ìë™ì°¨ë³´í—˜ ê²¬ì \",\n      \"ì‹¤ì†ë³´í—˜ ì•ˆë‚´\",\n      \"ë§ì¶¤ ì¶”ì²œ ë°›ê¸°\",\n      \"ìƒë‹´ì‚¬ ì—°ê²°\",\n      \"ë³´í—˜ë£Œ ê³„ì‚°\",\n      \"ì§€ì  ìœ„ì¹˜\",\n      \"ìš´ì „ìë³´í—˜ ìƒë‹´\",\n      \"ê±´ê°•ë³´í—˜ ìƒë‹´\"\n    ];\n    \n    // Loading and parsing persona CSV\n    function loadPersonaData() {\n      const loadingIndicator \u003d document.getElementById(\u0027loading-indicator\u0027);\n      loadingIndicator.classList.remove(\u0027hidden\u0027);\n      Papa.parse(loadFileData(\"ê³ ê°í˜ë¥´ì†Œë‚˜.csv\"), {\n        header: true,\n        skipEmptyLines: true,\n        dynamicTyping: false,\n        transformHeader: header \u003d\u003e header.trim().replace(/^\"|\"$/g, \u0027\u0027),\n        transform: (value, header) \u003d\u003e {\n          let cleaned \u003d value.trim().replace(/^\"|\"$/g, \u0027\u0027);\n          return cleaned;\n        },\n        complete: results \u003d\u003e {\n          personaData \u003d results.data.map(row \u003d\u003e ({\n            id: row[\"ID\"],\n            name: row[\"í˜ë¥´ì†Œë‚˜ëª…\"],\n            ageGroup: row[\"ì—°ë ¹ëŒ€\"],\n            gender: row[\"ì„±ë³„\"],\n            occupation: row[\"ì§ì—…\"],\n            residence: row[\"ê±°ì£¼ì§€\"],\n            vehicle: row[\"ì°¨ëŸ‰ ì •ë³´\"],\n            drivingExperience: row[\"ìš´ì „ ê²½ë ¥\"],\n            family: row[\"ê°€ì¡± êµ¬ì„±\"],\n            currentProduct: row[\"í˜„ì¬ ê°€ì… ìƒí’ˆ (í˜„ëŒ€í•´ìƒ)\"],\n            specialClauses: row[\"ì£¼ìš” íŠ¹ì•½ (í˜„ëŒ€í•´ìƒ ë‹¤ì´ë ‰íŠ¸ ê¸°ì¤€)\"],\n            monthlyPremium: parseFloat(row[\"ì›” í‰ê·  ë³´í—˜ë£Œ (ì¶”ì •)\"]?.replace(\"ë§Œì›\", \"\") || 0),\n            drivingPattern: row[\"ì£¼ìš” ì£¼í–‰ íŒ¨í„´\"],\n            drivingHabit: row[\"ìš´ì „ ìŠµê´€\"],\n            infoChannel: row[\"ì •ë³´ íƒìƒ‰ ì±„ë„\"],\n            coreNeeds: row[\"í•µì‹¬ ë‹ˆì¦ˆ\"],\n            painPoints: row[\"í˜ì¸ í¬ì¸íŠ¸\"],\n            preferenceReason: row[\"í˜„ëŒ€í•´ìƒ ë‹¤ì´ë ‰íŠ¸ ì„ í˜¸ ì´ìœ /ê¸°ëŒ€\"]\n          }));\n          loadingIndicator.classList.add(\u0027hidden\u0027);\n        },\n        error: err \u003d\u003e {\n          console.error(\"CSV parsing error:\", err);\n          loadingIndicator.classList.add(\u0027hidden\u0027);\n          addBotMessage(\"ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\n        }\n      });\n    }\n    \n    // Matching user to closest persona\n    function findMatchingPersona(profile) {\n      if (!profile || !profile.age || !profile.gender || !profile.occupation) {\n        return null;\n      }\n      \n      const age \u003d parseInt(profile.age);\n      const ageGroup \u003d age \u003e\u003d 20 \u0026\u0026 age \u003c 30 ? \"20ëŒ€\" : age \u003e\u003d 30 \u0026\u0026 age \u003c 50 ? \"30ëŒ€\" : \"40ëŒ€\";\n      let bestMatch \u003d null;\n      let highestScore \u003d 0;\n      \n      personaData.forEach(persona \u003d\u003e {\n        let score \u003d 0;\n        if (persona.ageGroup \u003d\u003d\u003d ageGroup) score +\u003d 3;\n        if (persona.gender \u003d\u003d\u003d profile.gender) score +\u003d 2;\n        if (persona.occupation.toLowerCase().includes(profile.occupation.toLowerCase())) score +\u003d 2;\n        if (profile.interest \u003d\u003d\u003d \"ìë™ì°¨ë³´í—˜\" \u0026\u0026 persona.currentProduct.includes(\"ìë™ì°¨ë³´í—˜\")) score +\u003d 1;\n        if (profile.interest \u003d\u003d\u003d \"ì‹¤ì†ë³´í—˜\" \u0026\u0026 !persona.currentProduct.includes(\"ìë™ì°¨ë³´í—˜\")) score +\u003d 1;\n        \n        if (score \u003e highestScore) {\n          highestScore \u003d score;\n          bestMatch \u003d persona;\n        }\n      });\n      \n      return bestMatch;\n    }\n    \n    // Generating personalized recommendation\n    function generateRecommendation(persona) {\n      if (!persona) {\n        return \"ê³ ê°ë‹˜ì˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì í•©í•œ ë³´í—˜ ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.\";\n      }\n      \n      return `ê³ ê°ë‹˜ê»˜ ì¶”ì²œë“œë¦¬ëŠ” ìƒí’ˆì€ ${persona.currentProduct}ì…ë‹ˆë‹¤.  \nì£¼ìš” íŠ¹ì•½: ${persona.specialClauses}  \nì¶”ì • ì›” ë³´í—˜ë£Œ: ${persona.monthlyPremium}ë§Œì›  \nê³ ê°ë‹˜ì˜ ìš´ì „ íŒ¨í„´(${persona.drivingPattern})ê³¼ ë‹ˆì¦ˆ(${persona.coreNeeds})ì— ì í•©í•˜ë©°, ${persona.preferenceReason}ì„ ì œê³µí•©ë‹ˆë‹¤.`;\n    }\n    \n    // Mock function to simulate file loading\n    function loadFileData(fileName) {\n      return \"ID,í˜ë¥´ì†Œë‚˜ëª…,ì—°ë ¹ëŒ€,ì„±ë³„,ì§ì—…,ê±°ì£¼ì§€,ì°¨ëŸ‰ ì •ë³´,ìš´ì „ ê²½ë ¥,ê°€ì¡± êµ¬ì„±,í˜„ì¬ ê°€ì… ìƒí’ˆ (í˜„ëŒ€í•´ìƒ),ì£¼ìš” íŠ¹ì•½ (í˜„ëŒ€í•´ìƒ ë‹¤ì´ë ‰íŠ¸ ê¸°ì¤€),ì›” í‰ê·  ë³´í—˜ë£Œ (ì¶”ì •),ì£¼ìš” ì£¼í–‰ íŒ¨í„´,ìš´ì „ ìŠµê´€,ì •ë³´ íƒìƒ‰ ì±„ë„,í•µì‹¬ ë‹ˆì¦ˆ,í˜ì¸ í¬ì¸íŠ¸,í˜„ëŒ€í•´ìƒ ë‹¤ì´ë ‰íŠ¸ ì„ í˜¸ ì´ìœ /ê¸°ëŒ€\\n1,ê¹€ì§€ì˜,30ëŒ€,ì—¬ì„±,ì‚¬ë¬´ì§,ì„œìš¸,ì†Œí˜• SUV,5ë…„,2ì¸ ê°€ì¡±,ìë™ì°¨ë³´í—˜,ëŒ€ì¸ë°°ìƒ/ëŒ€ë¬¼ë°°ìƒ,5ë§Œì›,ë„ì‹¬ ì£¼í–‰,ì•ˆì „ìš´ì „,ì˜¨ë¼ì¸,í•©ë¦¬ì ì¸ ë³´í—˜ë£Œ,ë³µì¡í•œ ê°€ì… ì ˆì°¨,ê°„í¸í•œ ì˜¨ë¼ì¸ ê°€ì…\";\n    }\n    \n    // Check for Google Apps Script environment\n    function isGoogleScriptAvailable() {\n      return typeof google !\u003d\u003d \u0027undefined\u0027 \u0026\u0026 google.script \u0026\u0026 google.script.run;\n    }\n    \n    // Save chat history to localStorage\n    function saveChatHistory(messages) {\n      localStorage.setItem(\u0027hicareBotChat\u0027, JSON.stringify(messages));\n    }\n    \n    // Load chat history from localStorage\n    function loadChatHistory() {\n      const saved \u003d localStorage.getItem(\u0027hicareBotChat\u0027);\n      return saved ? JSON.parse(saved) : [];\n    }\n    \n    // Save chat log to a text file\n    function saveChatLogToFile() {\n      const chatHistory \u003d loadChatHistory();\n      const timestamp \u003d new Date().toISOString().replace(/[:.]/g, \u0027-\u0027);\n      const filename \u003d `hicarebot_chatlog_${timestamp}.txt`;\n      let logContent \u003d `í˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´(Hi-Care) ë´‡ ëŒ€í™” ë¡œê·¸\\nìƒì„±ì¼: ${new Date().toLocaleString(\u0027ko-KR\u0027)}\\nì‚¬ìš©ì: ${userProfile.name || \u0027ìµëª…\u0027}\\n\\n`;\n      \n      chatHistory.forEach(msg \u003d\u003e {\n        const sender \u003d msg.type \u003d\u003d\u003d \u0027bot\u0027 ? \u0027í•˜ì´ì¼€ì–´ë´‡\u0027 : \u0027ì‚¬ìš©ì\u0027;\n        logContent +\u003d `[${sender}]: ${msg.text}\\n`;\n      });\n      \n      const blob \u003d new Blob([logContent], { type: \u0027text/plain;charset\u003dutf-8\u0027 });\n      const url \u003d URL.createObjectURL(blob);\n      const link \u003d document.createElement(\u0027a\u0027);\n      link.href \u003d url;\n      link.download \u003d filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      \n      addBotMessage(\"ëŒ€í™” ë¡œê·¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\");\n    }\n    \n    // Validate profile form\n    function validateProfileForm() {\n      let isValid \u003d true;\n      const name \u003d document.getElementById(\u0027name\u0027).value.trim();\n      const gender \u003d document.getElementById(\u0027gender\u0027).value;\n      const age \u003d parseInt(document.getElementById(\u0027age\u0027).value);\n      const occupation \u003d document.getElementById(\u0027occupation\u0027).value;\n      \n      const nameError \u003d document.getElementById(\u0027name-error\u0027);\n      const genderError \u003d document.getElementById(\u0027gender-error\u0027);\n      const ageError \u003d document.getElementById(\u0027age-error\u0027);\n      const occupationError \u003d document.getElementById(\u0027occupation-error\u0027);\n      \n      nameError.style.display \u003d \u0027none\u0027;\n      genderError.style.display \u003d \u0027none\u0027;\n      ageError.style.display \u003d \u0027none\u0027;\n      occupationError.style.display \u003d \u0027none\u0027;\n      \n      if (!name || name.length \u003c 2 || name.length \u003e 50) {\n        nameError.style.display \u003d \u0027block\u0027;\n        isValid \u003d false;\n      }\n      \n      if (!gender) {\n        genderError.style.display \u003d \u0027block\u0027;\n        isValid \u003d false;\n      }\n      \n      if (isNaN(age) || age \u003c 18 || age \u003e 100) {\n        ageError.style.display \u003d \u0027block\u0027;\n        isValid \u003d false;\n      }\n      \n      if (!occupation) {\n        occupationError.style.display \u003d \u0027block\u0027;\n        isValid \u003d false;\n      }\n      \n      return isValid;\n    }\n    \n    // Show autocomplete suggestions\n    function showAutocompleteSuggestions(input) {\n      const suggestionsContainer \u003d document.getElementById(\u0027autocomplete-suggestions\u0027);\n      suggestionsContainer.innerHTML \u003d \u0027\u0027;\n      if (!input) {\n        suggestionsContainer.style.display \u003d \u0027none\u0027;\n        return;\n      }\n      \n      const filteredSuggestions \u003d autocompleteSuggestions.filter(s \u003d\u003e\n        s.toLowerCase().includes(input.toLowerCase())\n      );\n      \n      if (filteredSuggestions.length \u003e 0) {\n        filteredSuggestions.forEach(suggestion \u003d\u003e {\n          const div \u003d document.createElement(\u0027div\u0027);\n          div.className \u003d \u0027autocomplete-suggestion\u0027;\n          div.textContent \u003d suggestion;\n          div.setAttribute(\u0027role\u0027, \u0027option\u0027);\n          div.setAttribute(\u0027tabindex\u0027, \u00270\u0027);\n          div.addEventListener(\u0027click\u0027, () \u003d\u003e {\n            document.getElementById(\u0027user-input\u0027).value \u003d suggestion;\n            suggestionsContainer.style.display \u003d \u0027none\u0027;\n            sendMessage();\n          });\n          div.addEventListener(\u0027keypress\u0027, (e) \u003d\u003e {\n            if (e.key \u003d\u003d\u003d \u0027Enter\u0027) {\n              document.getElementById(\u0027user-input\u0027).value \u003d suggestion;\n              suggestionsContainer.style.display \u003d \u0027none\u0027;\n              sendMessage();\n            }\n          });\n          suggestionsContainer.appendChild(div);\n        });\n        suggestionsContainer.style.display \u003d \u0027block\u0027;\n      } else {\n        suggestionsContainer.style.display \u003d \u0027none\u0027;\n      }\n    }\n    \n    // Initializing event listeners\n    document.addEventListener(\u0027DOMContentLoaded\u0027, function() {\n      const startButton \u003d document.getElementById(\u0027start-button\u0027);\n      const submitProfileButton \u003d document.getElementById(\u0027submit-profile\u0027);\n      const sendButton \u003d document.getElementById(\u0027send-button\u0027);\n      const userInput \u003d document.getElementById(\u0027user-input\u0027);\n      const welcomeScreen \u003d document.getElementById(\u0027welcome-screen\u0027);\n      const profileScreen \u003d document.getElementById(\u0027profile-screen\u0027);\n      const chatScreen \u003d document.getElementById(\u0027chat-screen\u0027);\n      const chatContainer \u003d document.getElementById(\u0027chat-container\u0027);\n      const quickButtonsContainer \u003d document.getElementById(\u0027quick-buttons\u0027);\n      const categoryButtons \u003d document.querySelectorAll(\u0027.category-button\u0027);\n      const feedbackButton \u003d document.getElementById(\u0027feedback-button\u0027);\n      const saveLogButton \u003d document.getElementById(\u0027save-log-button\u0027);\n      \n      // Load persona data and chat history regardless of Google Apps Script environment\n      loadPersonaData();\n      const chatHistory \u003d loadChatHistory();\n      chatHistory.forEach(msg \u003d\u003e appendMessage(msg.text, msg.type));\n      \n      // Handling start button click\n      startButton.addEventListener(\u0027click\u0027, function() {\n        console.log(\u0027Start button clicked\u0027);\n        welcomeScreen.classList.add(\u0027hidden\u0027);\n        profileScreen.classList.remove(\u0027hidden\u0027);\n        document.getElementById(\u0027name\u0027).focus();\n      });\n      \n      // Add keyboard support for start button\n      startButton.addEventListener(\u0027keypress\u0027, function(e) {\n        if (e.key \u003d\u003d\u003d \u0027Enter\u0027 || e.key \u003d\u003d\u003d \u0027 \u0027) {\n          console.log(\u0027Start button activated via keyboard\u0027);\n          welcomeScreen.classList.add(\u0027hidden\u0027);\n          profileScreen.classList.remove(\u0027hidden\u0027);\n          document.getElementById(\u0027name\u0027).focus();\n        }\n      });\n      \n      // Handling profile submission\n      submitProfileButton.addEventListener(\u0027click\u0027, function() {\n        if (!validateProfileForm()) return;\n        \n        userProfile.name \u003d document.getElementById(\u0027name\u0027).value || \"ê³ ê°\";\n        userProfile.gender \u003d document.getElementById(\u0027gender\u0027).value || \"ë¯¸ì…ë ¥\";\n        userProfile.age \u003d parseInt(document.getElementById(\u0027age\u0027).value) || 30;\n        userProfile.occupation \u003d document.getElementById(\u0027occupation\u0027).value || \"ë¯¸ì…ë ¥\";\n        userProfile.income \u003d parseInt(document.getElementById(\u0027income\u0027).value) || 0;\n        userProfile.insuranceExperience \u003d document.getElementById(\u0027insurance-experience\u0027).value || \"ë¯¸ì…ë ¥\";\n        userProfile.interest \u003d document.getElementById(\u0027interest\u0027).value || \"ë¯¸ì •/ìƒë‹´í•„ìš”\";\n        \n        // Simulate Google Apps Script save (mock for non-GAS environment)\n        if (!isGoogleScriptAvailable()) {\n          console.warn(\u0027Google Apps Script not detected, simulating profile save\u0027);\n          profileScreen.classList.add(\u0027hidden\u0027);\n          chatScreen.classList.remove(\u0027hidden\u0027);\n          showTypingIndicator();\n          setTimeout(function() {\n            removeTypingIndicator();\n            addBotMessage(`ì•ˆë…•í•˜ì„¸ìš”, ${userProfile.name}ë‹˜! í˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´(Hi-Care) ë´‡ì…ë‹ˆë‹¤. ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ì˜ë£Œë³´í—˜ì„ í¬í•¨í•œ ë§ì¶¤ ìƒë‹´ì„ ì‹œì‘í•©ë‹ˆë‹¤. ğŸ˜Š`);\n            showTypingIndicator();\n            setTimeout(function() {\n              removeTypingIndicator();\n              const matchedPersona \u003d findMatchingPersona(userProfile);\n              if (userProfile.age \u003e\u003d 20 \u0026\u0026 userProfile.age \u003c 30) {\n                addBotMessage(\"20ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ì €ë ´í•œ ë³´í—˜ë£Œì™€ ë¹ ë¥¸ ì˜¨ë¼ì¸ ê°€ì… ìƒí’ˆì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\");\n                if (matchedPersona) {\n                  addBotMessage(generateRecommendation(matchedPersona));\n                }\n              } else if (userProfile.age \u003e\u003d 30 \u0026\u0026 userProfile.age \u003c 50) {\n                addBotMessage(\"30~40ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ë³´í—˜ì˜ ë¹„êµ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.\");\n                if (matchedPersona) {\n                  addBotMessage(generateRecommendation(matchedPersona));\n                }\n              } else {\n                addBotMessage(\"ì•ˆì „ê³¼ ê±´ê°•ì„ ìœ„í•œ ìƒë‹´ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\");\n              }\n              updateInitialQuickButtons();\n            }, Math.random() * 1000 + 1000);\n          }, Math.random() * 1000 + 1000);\n          return;\n        }\n        \n        google.script.run.withSuccessHandler(function(result) {\n          if (result \u0026\u0026 result.success) {\n            profileScreen.classList.add(\u0027hidden\u0027);\n            chatScreen.classList.remove(\u0027hidden\u0027);\n            showTypingIndicator();\n            setTimeout(function() {\n              removeTypingIndicator();\n              addBotMessage(`ì•ˆë…•í•˜ì„¸ìš”, ${userProfile.name}ë‹˜! í˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´(Hi-Care) ë´‡ì…ë‹ˆë‹¤. ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ì˜ë£Œë³´í—˜ì„ í¬í•¨í•œ ë§ì¶¤ ìƒë‹´ì„ ì‹œì‘í•©ë‹ˆë‹¤. ğŸ˜Š`);\n              showTypingIndicator();\n              setTimeout(function() {\n                removeTypingIndicator();\n                const matchedPersona \u003d findMatchingPersona(userProfile);\n                if (userProfile.age \u003e\u003d 20 \u0026\u0026 userProfile.age \u003c 30) {\n                  addBotMessage(\"20ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ì €ë ´í•œ ë³´í—˜ë£Œì™€ ë¹ ë¥¸ ì˜¨ë¼ì¸ ê°€ì… ìƒí’ˆì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\");\n                  if (matchedPersona) {\n                    addBotMessage(generateRecommendation(matchedPersona));\n                  }\n                } else if (userProfile.age \u003e\u003d 30 \u0026\u0026 userProfile.age \u003c 50) {\n                  addBotMessage(\"30~40ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ë³´í—˜ì˜ ë¹„êµ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.\");\n                  if (matchedPersona) {\n                    addBotMessage(generateRecommendation(matchedPersona));\n                  }\n                } else {\n                  addBotMessage(\"ì•ˆì „ê³¼ ê±´ê°•ì„ ìœ„í•œ ìƒë‹´ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\");\n                }\n                updateInitialQuickButtons();\n              }, Math.random() * 1000 + 1000);\n            }, Math.random() * 1000 + 1000);\n          } else {\n            addBotMessage(\"í”„ë¡œí•„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\");\n          }\n        }).withFailureHandler(function(error) {\n          addBotMessage(\"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: \" + error.message);\n        }).saveUserProfile(userProfile);\n      });\n      \n      // Handling category button clicks\n      categoryButtons.forEach(button \u003d\u003e {\n        button.addEventListener(\u0027click\u0027, function() {\n          const category \u003d this.getAttribute(\u0027data-category\u0027);\n          showProductInfo(category);\n        });\n        button.addEventListener(\u0027keypress\u0027, function(e) {\n          if (e.key \u003d\u003d\u003d \u0027Enter\u0027) {\n            const category \u003d this.getAttribute(\u0027data-category\u0027);\n            showProductInfo(category);\n          }\n        });\n      });\n      \n      // Handling send button and enter key\n      sendButton.addEventListener(\u0027click\u0027, sendMessage);\n      userInput.addEventListener(\u0027keypress\u0027, function(e) {\n        if (e.key \u003d\u003d\u003d \u0027Enter\u0027) sendMessage();\n      });\n      \n      // Autocomplete for user input\n      userInput.addEventListener(\u0027input\u0027, function() {\n        showAutocompleteSuggestions(this.value);\n      });\n      \n      // Hide autocomplete on blur\n      userInput.addEventListener(\u0027blur\u0027, function() {\n        setTimeout(() \u003d\u003e {\n          document.getElementById(\u0027autocomplete-suggestions\u0027).style.display \u003d \u0027none\u0027;\n        }, 200);\n      });\n      \n      // Handling feedback button\n      feedbackButton.addEventListener(\u0027click\u0027, function() {\n        addBotMessage(\"í”¼ë“œë°±ì„ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ìƒë‹´ì´ ë„ì›€ì´ ë˜ì—ˆëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”.\");\n        updateQuickButtons([\"ë§¤ìš° ë§Œì¡±\", \"ë§Œì¡±\", \"ë³´í†µ\", \"ë¶ˆë§Œì¡±\", \"ë§¤ìš° ë¶ˆë§Œì¡±\"]);\n      });\n      \n      // Handling save log button\n      saveLogButton.addEventListener(\u0027click\u0027, function() {\n        saveChatLogToFile();\n      });\n      \n      saveLogButton.addEventListener(\u0027keypress\u0027, function(e) {\n        if (e.key \u003d\u003d\u003d \u0027Enter\u0027 || e.key \u003d\u003d\u003d \u0027 \u0027) {\n          saveChatLogToFile();\n        }\n      });\n      \n      // Sending user message\n      function sendMessage() {\n        const message \u003d userInput.value.trim();\n        if (message) {\n          appendMessage(message, \"user\");\n          userInput.value \u003d \u0027\u0027;\n          document.getElementById(\u0027autocomplete-suggestions\u0027).style.display \u003d \u0027none\u0027;\n          showTypingIndicator();\n          if (!isGoogleScriptAvailable()) {\n            removeTypingIndicator();\n            addBotMessage(\"Google Apps Script í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ëŠ” í…ŒìŠ¤íŠ¸ ëª¨ë“œì…ë‹ˆë‹¤.\");\n            updateQuickButtonsByMessage(message);\n            return;\n          }\n          google.script.run.withSuccessHandler(function(reply) {\n            removeTypingIndicator();\n            addBotMessage(reply);\n            if (message \u003d\u003d\u003d \"ì²˜ìŒìœ¼ë¡œ\") {\n              resetChat();\n            } else {\n              updateQuickButtonsByMessage(message);\n            }\n          }).withFailureHandler(function(error) {\n            removeTypingIndicator();\n            addBotMessage(\"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: \" + error.message);\n          }).processUserInput(message, userProfile);\n        }\n      }\n      \n      // Handling quick button clicks\n      function handleQuickButtonClick(buttonText) {\n        userInput.value \u003d buttonText;\n        sendMessage();\n      }\n      \n      // Updating initial quick buttons\n      function updateInitialQuickButtons() {\n        const personalizedButtons \u003d [\"ìë™ì°¨ë³´í—˜ ì•ˆë‚´\", \"ì‹¤ì†ì˜ë£Œë³´í—˜ ì•ˆë‚´\", \"ë§ì¶¤ ì¶”ì²œ ë°›ê¸°\", \"ìƒë‹´ì‚¬ ì—°ê²°\"];\n        if (userProfile.interest \u003d\u003d\u003d \"ìë™ì°¨ë³´í—˜\") {\n          personalizedButtons.unshift(\"ìë™ì°¨ë³´í—˜ ê²¬ì \");\n        } else if (userProfile.interest \u003d\u003d\u003d \"ì‹¤ì†ë³´í—˜\") {\n          personalizedButtons.unshift(\"ì‹¤ì†ë³´í—˜ ì•ˆë‚´\");\n        }\n        updateQuickButtons(personalizedButtons);\n      }\n      \n      // Updating quick buttons dynamically\n      function updateQuickButtons(buttons) {\n        quickButtonsContainer.innerHTML \u003d \u0027\u0027;\n        buttons.forEach(buttonText \u003d\u003e {\n          const button \u003d document.createElement(\u0027div\u0027);\n          button.className \u003d \u0027quick-button\u0027;\n          button.textContent \u003d buttonText;\n          button.setAttribute(\u0027role\u0027, \u0027button\u0027);\n          button.setAttribute(\u0027tabindex\u0027, \u00270\u0027);\n          button.addEventListener(\u0027click\u0027, function() { handleQuickButtonClick(buttonText); });\n          button.addEventListener(\u0027keypress\u0027, function(e) {\n            if (e.key \u003d\u003d\u003d \u0027Enter\u0027) handleQuickButtonClick(buttonText);\n          });\n          quickButtonsContainer.appendChild(button);\n        });\n        // Adding \"ì²˜ìŒìœ¼ë¡œ\" button\n        const backButton \u003d document.createElement(\u0027div\u0027);\n        backButton.className \u003d \u0027quick-button\u0027;\n        backButton.textContent \u003d \u0027ì²˜ìŒìœ¼ë¡œ\u0027;\n        backButton.setAttribute(\u0027role\u0027, \u0027button\u0027);\n        backButton.setAttribute(\u0027tabindex\u0027, \u00270\u0027);\n        backButton.addEventListener(\u0027click\u0027, function() { handleQuickButtonClick(\u0027ì²˜ìŒìœ¼ë¡œ\u0027); });\n        backButton.addEventListener(\u0027keypress\u0027, function(e) {\n          if (e.key \u003d\u003d\u003d \u0027Enter\u0027) handleQuickButtonClick(\u0027ì²˜ìŒìœ¼ë¡œ\u0027);\n        });\n        quickButtonsContainer.appendChild(backButton);\n      }\n      \n      // Updating quick buttons based on user message\n      function updateQuickButtonsByMessage(message) {\n        message \u003d message.toLowerCase();\n        if (message.includes(\u0027ìë™ì°¨\u0027) || message.includes(\u0027ì°¨ëŸ‰\u0027)) {\n          updateQuickButtons(insuranceProducts[\"ìë™ì°¨ë³´í—˜\"].quickButtons);\n        } else if (message.includes(\u0027ì‹¤ì†\u0027) || message.includes(\u0027ì˜ë£Œ\u0027)) {\n          updateQuickButtons(insuranceProducts[\"ì‹¤ì†ì˜ë£Œë³´í—˜\"].quickButtons);\n        } else if (message.includes(\u0027ì¶”ì²œ\u0027)) {\n          updateQuickButtons(insuranceProducts[\"ì¶”ì²œìƒí’ˆ\"].quickButtons);\n        } else if (message.includes(\u0027ë§Œì¡±\u0027) || message.includes(\u0027ë¶ˆë§Œì¡±\u0027)) {\n          updateQuickButtons([\"ìë™ì°¨ë³´í—˜ ì•ˆë‚´\", \"ì‹¤ì†ì˜ë£Œë³´í—˜ ì•ˆë‚´\", \"ë§ì¶¤ ì¶”ì²œ ë°›ê¸°\", \"ìƒë‹´ì‚¬ ì—°ê²°\"]);\n          addBotMessage(\"í”¼ë“œë°±ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ ë„ì™€ë“œë¦´ê¹Œìš”?\");\n        } else {\n          updateInitialQuickButtons();\n        }\n      }\n      \n      // Resetting chat to initial state\n      function resetChat() {\n        chatContainer.innerHTML \u003d \u0027\u003cdiv id\u003d\"loading-indicator\" class\u003d\"loading-indicator hidden\"\u003eë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...\u003c/div\u003e\u0027;\n        saveChatHistory([]);\n        showTypingIndicator();\n        setTimeout(function() {\n          removeTypingIndicator();\n          addBotMessage(`ì•ˆë…•í•˜ì„¸ìš”, ${userProfile.name}ë‹˜! í˜„ëŒ€í•´ìƒ í•˜ì´ì¼€ì–´(Hi-Care) ë´‡ì…ë‹ˆë‹¤. ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ì˜ë£Œë³´í—˜ì„ í¬í•¨í•œ ë§ì¶¤ ìƒë‹´ì„ ì‹œì‘í•©ë‹ˆë‹¤. ğŸ˜Š`);\n          showTypingIndicator();\n          setTimeout(function() {\n            removeTypingIndicator();\n            const matchedPersona \u003d findMatchingPersona(userProfile);\n            if (userProfile.age \u003e\u003d 20 \u0026\u0026 userProfile.age \u003c 30) {\n              addBotMessage(\"20ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ì €ë ´í•œ ë³´í—˜ë£Œì™€ ë¹ ë¥¸ ì˜¨ë¼ì¸ ê°€ì… ìƒí’ˆì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\");\n              if (matchedPersona) {\n                addBotMessage(generateRecommendation(matchedPersona));\n              }\n            } else if (userProfile.age \u003e\u003d 30 \u0026\u0026 userProfile.age \u003c 50) {\n              addBotMessage(\"30~40ëŒ€ ê³ ê°ë‹˜ê»˜ëŠ” ìë™ì°¨ë³´í—˜ê³¼ ì‹¤ì†ë³´í—˜ì˜ ë¹„êµ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.\");\n              if (matchedPersona) {\n                addBotMessage(generateRecommendation(matchedPersona));\n              }\n            } else {\n              addBotMessage(\"ì•ˆì „ê³¼ ê±´ê°•ì„ ìœ„í•œ ìƒë‹´ì„ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\");\n            }\n            updateInitialQuickButtons();\n          }, Math.random() * 1000 + 1000);\n        }, Math.random() * 1000 + 1000);\n      }\n      \n      // Displaying product information\n      function showProductInfo(category) {\n        if (insuranceProducts[category]) {\n          addBotMessage(`${insuranceProducts[category].description}`);\n          setTimeout(() \u003d\u003e {\n            addBotMessage(`ê´€ì‹¬ ìˆëŠ” ${category}ì˜ ì„¸ë¶€ ìƒí’ˆì€ ${insuranceProducts[category].subCategories.join(\u0027, \u0027)}ì…ë‹ˆë‹¤.`);\n            updateQuickButtons(insuranceProducts[category].quickButtons);\n          }, Math.random() * 500 + 500);\n        }\n      }\n      \n      // Showing typing indicator\n      function showTypingIndicator() {\n        const typingDiv \u003d document.createElement(\u0027div\u0027);\n        typingDiv.className \u003d \u0027message bot typing-group\u0027;\n        typingDiv.innerHTML \u003d `\n          \u003cimg src\u003d\"https://i.ibb.co/D1cNQ2j/hicarebot-avatar.png\" alt\u003d\"bot\" class\u003d\"avatar\" role\u003d\"img\" aria-label\u003d\"ë´‡ ì•„ë°”íƒ€\"\u003e\n          \u003cdiv class\u003d\"typing-indicator\"\u003e\n            \u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e\u003c/span\u003e\n          \u003c/div\u003e`;\n        chatContainer.appendChild(typingDiv);\n        chatContainer.scrollTop \u003d chatContainer.scrollHeight;\n      }\n      \n      // Removing typing indicator\n      function removeTypingIndicator() {\n        const typingGroup \u003d document.querySelector(\u0027.typing-group\u0027);\n        if (typingGroup) typingGroup.remove();\n      }\n      \n      // Adding bot message\n      function addBotMessage(message) {\n        const messageDiv \u003d document.createElement(\u0027div\u0027);\n        messageDiv.className \u003d \u0027message bot\u0027;\n        messageDiv.innerHTML \u003d `\n          \u003cimg src\u003d\"https://i.ibb.co/D1cNQ2j/hicarebot-avatar.png\" alt\u003d\"bot\" class\u003d\"avatar\" role\u003d\"img\" aria-label\u003d\"ë´‡ ì•„ë°”íƒ€\"\u003e\n          \u003cdiv class\u003d\"bubble bot\"\u003e${message}\u003c/div\u003e`;\n        chatContainer.appendChild(messageDiv);\n        chatContainer.scrollTop \u003d chatContainer.scrollHeight;\n        saveChatHistory([...loadChatHistory(), { text: message, type: \u0027bot\u0027 }]);\n      }\n      \n      // Adding user message\n      function appendMessage(text, type) {\n        const messageDiv \u003d document.createElement(\u0027div\u0027);\n        messageDiv.className \u003d `message ${type}`;\n        messageDiv.innerHTML \u003d `\n          \u003cimg src\u003d\"${type \u003d\u003d\u003d \u0027bot\u0027 ? \u0027https://i.ibb.co/D1cNQ2j/hicarebot-avatar.png\u0027 : \u0027https://i.ibb.co/JBqtqtT/user-icon.png\u0027}\" alt\u003d\"${type}\" class\u003d\"avatar\" role\u003d\"img\" aria-label\u003d\"${type \u003d\u003d\u003d \u0027bot\u0027 ? \u0027ë´‡ ì•„ë°”íƒ€\u0027 : \u0027ì‚¬ìš©ì ì•„ë°”íƒ€\u0027}\"\u003e\n          \u003cdiv class\u003d\"bubble ${type}\"\u003e${text}\u003c/div\u003e`;\n        chatContainer.appendChild(messageDiv);\n        chatContainer.scrollTop \u003d chatContainer.scrollHeight;\n        if (type \u003d\u003d\u003d \u0027user\u0027) {\n          saveChatHistory([...loadChatHistory(), { text, type }]);\n        }\n      }\n      \n      // Warn about Google Apps Script if not available\n      if (!isGoogleScriptAvailable()) {\n        console.warn(\u0027Google Apps Script environment not detected. Some features may be limited.\u0027);\n      }\n    });\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"}]}